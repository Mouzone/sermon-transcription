# Backend

This directory contains the Python backend for the Sermon Scraper & Transcriber project.

## üß∞ Stack
- `uv` (package manager)
- Python
- Docker

## ‚öôÔ∏è Methodology
The backend performs the following steps:
1. Scrapes the [YouTube livestreams page of Arumdaum EM](https://www.youtube.com/@ArumdaunEM/streams) to find the latest sermon's title and YouTube link.
2. Downloads the sermon into a folder named `sermons` within the Docker container or locally.
3. Sends the video file to AssemblyAI for transcription.
4. Passes the transcription to Google's Gemini 2.0 Flash model to:
   - Split into logical sections
   - Edit for readability
5. Uploads the original transcription and the sectioned version to a Supabase database via PostgREST.
6. Deletes the downloaded video file to clean up.

## ‚ñ∂Ô∏è Run Instructions

### Prerequisites
- Create a `.env` file in the `backend` directory with the following credentials:
  - `ASSEMBLYAI_API_KEY`: Your AssemblyAI API key.
  - `GEMINI_API_KEY`: Your Gemini API key.
  - `SUPABASE_URL`: Your Supabase database URL.
  - `SUPABASE_KEY`: Your Supabase service role key.

### Running Locally
1. Ensure you have Python and `uv` installed.
2. Navigate to the `backend` directory.
3. Install dependencies: `uv pip install -r requirements.txt` (if a requirements.txt is generated by uv) or `uv install` (if uv uses a different mechanism like pyproject.toml with a dedicated uv section). *Self-correction: Check the main README.md, it mentions `uv run main.py` which implies dependencies are managed via `pyproject.toml` and `uv.lock`.*
4. Run the main script: `uv run main.py`

### üê≥ Running with Docker
The backend is Dockerized for deployment and consistent execution environments.
- The `Dockerfile` sets up the Python environment, installs `uv`, Chrome for Selenium, and necessary dependencies.
- It creates a `sermons` folder inside the container for temporary video storage.

**To build and run the Docker container locally:**
1. Ensure Docker is installed and running.
2. Navigate to the `backend` directory.
3. Build the Docker image: `docker build -t sermon-backend .`
4. Run the Docker container:
   ```bash
   docker run --env-file .env sermon-backend
   ```
   (Ensure your `.env` file is in the `backend` directory).

**Deployment:**
- The backend is designed to be deployed on services like Google Cloud Run, utilizing Cloud Scheduler for daily automation.
- ‚ö†Ô∏è **Note:** Google Cloud Run‚Äôs IPs are often blacklisted from downloading YouTube videos. Running locally (e.g., on a Raspberry Pi with a cron job) might be a more reliable solution for daily execution if this issue is encountered.

## Logging
- The application logs its progress and any errors to `sermon_processor.log` within the `backend` directory. Check this file for troubleshooting.
